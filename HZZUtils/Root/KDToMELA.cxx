// $Id: HelicityAngles.cxx 661671 2015-04-20 16:55:03Z schaffer $

// ROOT include(s):
#include <TMath.h>

// Local include(s):
#include "HZZUtils/KDToMELA.h"

namespace HZZUtils
{
    
    float c_factor(float m4l_unconstrained, int event_type ) {
        
        double m[200]={200, 205, 210, 215, 220, 225, 230, 235, 240, 245, 250, 255, 260, 265, 270, 275, 280, 285, 290, 295, 300, 305, 310, 315, 320, 325, 330, 335, 340, 345, 350, 355, 360, 365, 370, 375, 380, 385, 390, 395, 400, 405, 410, 415, 420, 425, 430, 435, 440, 445, 450, 455, 460, 465, 470, 475, 480, 485, 490, 495, 500, 505, 510, 515, 520, 525, 530, 535, 540, 545, 550, 555, 560, 565, 570, 575, 580, 585, 590, 595, 600, 605, 610, 615, 620, 625, 630, 635, 640, 645, 650, 655, 660, 665, 670, 675, 680, 685, 690, 695, 700, 705, 710, 715, 720, 725, 730, 735, 740, 745, 750, 755, 760, 765, 770, 775, 780, 785, 790, 795, 800, 805, 810, 815, 820, 825, 830, 835, 840, 845, 850, 855, 860, 865, 870, 875, 880, 885, 890, 895, 900, 905, 910, 915, 920, 925, 930, 935, 940, 945, 950, 955, 960, 965, 970, 975, 980, 985, 990, 995, 1000, 1005, 1010, 1015, 1020, 1025, 1030, 1035, 1040, 1045, 1050, 1055, 1060, 1065, 1070, 1075, 1080, 1085, 1090, 1095, 1100, 1105, 1110, 1115, 1120, 1125, 1130, 1135, 1140, 1145, 1150, 1155, 1160, 1165, 1170, 1175, 1180, 1185, 1190, 1195};
        double y[200]={};
        
        double y0[200]={-1.36173, -1.33065, -1.30211, -1.27595, -1.25202, -1.23019, -1.21033, -1.19229, -1.17594, -1.16116, -1.14782, -1.1358, -1.12497, -1.11523, -1.10644, -1.09851, -1.09132, -1.08476, -1.07874, -1.07314, -1.06788, -1.06286, -1.05798, -1.05315, -1.04829, -1.04332, -1.03815, -1.0327, -1.0269, -1.02068, -1.01395, -1.00667, -0.99876, -0.990159, -0.98081, -0.970655, -0.959643, -0.947722, -0.934844, -0.920963, -0.906039, -0.890031, -0.872902, -0.85462, -0.835151, -0.814469, -0.792547, -0.769363, -0.744897, -0.719132, -0.692053, -0.663649, -0.633911, -0.602833, -0.570411, -0.536646, -0.50154, -0.465098, -0.427328, -0.38824, -0.347849, -0.30617, -0.263223, -0.219029, -0.173614, -0.127005, -0.0792324, -0.0303289, 0.0196693, 0.0707236, 0.110437, 0.174143, 0.234084, 0.288703, 0.339186, 0.388112, 0.438404, 0.492943, 0.553143, 0.617268, 0.679831, 0.734244, 0.778418, 0.817756, 0.861399, 0.914438, 0.974073, 1.03346, 1.08863, 1.14087, 1.19402, 1.251, 1.31253, 1.37797, 1.44629, 1.51578, 1.58166, 1.63669, 1.67667, 1.70546, 1.7341, 1.7729, 1.82263, 1.86785, 1.88644, 1.86893, 1.82275, 1.76594, 1.71251, 1.66439, 1.61589, 1.55607, 1.47165, 1.3528, 1.19941, 1.02626, 0.856771, 0.702728, 0.552221, 0.381083, 0.177926, -0.0429414, -0.253437, -0.436064, -0.59694, -0.75449, -0.918772, -1.08663, -1.25008, -1.40534, -1.55942, -1.72528, -1.90638, -2.08854, -2.25031, -2.38253, -2.49747, -2.6166, -2.75166, -2.90184, -3.08781, -3.2507, -3.40961, -3.56464, -3.71588, -3.86343, -4.00738, -4.14784, -4.2849, -4.41864, -4.54918, -4.6766, -4.80099, -4.92247, -5.04112, -5.15703, -5.27031, -5.38105, -5.48934, -5.59528, -5.69897, -5.8005, -5.89997, -5.99748, -6.09311, -6.18698, -6.27916, -6.36976, -6.45887, -6.5466, -6.63302, -6.71825, -6.80238, -6.8855, -6.9677, -7.04909, -7.12976, -7.20981, -7.28933, -7.36841, -7.44716, -7.52567, -7.60403, -7.68235, -7.76071, -7.83921, -7.91795, -7.99703, -8.07654, -8.15657, -8.23722, -8.31859, -8.40077, -8.48387, -8.56797, -8.65316, -8.73956, -8.82725, -8.91632, -9.00688};
        double y1[200]={-1.25875, -1.24611, -1.23356, -1.22109, -1.20871, -1.19641, -1.18421, -1.17209, -1.16005, -1.14809, -1.1362, -1.12438, -1.11262, -1.10091, -1.08925, -1.07762, -1.06601, -1.05441, -1.0428, -1.03118, -1.01952, -1.00781, -0.996037, -0.984175, -0.972206, -0.960111, -0.947866, -0.93545, -0.922838, -0.910006, -0.896928, -0.883577, -0.869923, -0.85594, -0.841596, -0.826859, -0.811699, -0.796081, -0.779972, -0.763335, -0.746134, -0.728333, -0.709891, -0.69077, -0.670929, -0.650326, -0.628919, -0.606664, -0.583515, -0.559427, -0.534353, -0.508245, -0.481054, -0.45273, -0.423221, -0.392476, -0.360441, -0.327062, -0.292283, -0.256049, -0.218301, -0.178981, -0.138029, -0.0953858, -0.0509887, -0.00477516, 0.0433186, 0.0933573, 0.145407, 0.199534, 0.289866, 0.33526, 0.388436, 0.448557, 0.512263, 0.575091, 0.63371, 0.687582, 0.739469, 0.793814, 0.85337, 0.91705, 0.979537, 1.0341, 1.0785, 1.11807, 1.16177, 1.21507, 1.27789, 1.34654, 1.41592, 1.48061, 1.53555, 1.57827, 1.61114, 1.64266, 1.68515, 1.7472, 1.82788, 1.91326, 1.98144, 2.01874, 2.02928, 2.02993, 2.03884, 2.06585, 2.0991, 2.11056, 2.08473, 2.02218, 1.9319, 1.8284, 1.72038, 1.60625, 1.48027, 1.3393, 1.18334, 1.01271, 0.826958, 0.627529, 0.423219, 0.227164, 0.0459118, -0.126507, -0.30267, -0.489194, -0.680494, -0.864295, -1.03268, -1.18776, -1.33894, -1.49555, -1.66089, -1.83156, -2.00234, -2.17213, -2.34359, -2.51938, -2.69925, -2.8778, -3.05054, -3.17671, -3.3019, -3.42609, -3.54928, -3.67146, -3.79261, -3.91272, -4.03178, -4.14978, -4.26672, -4.38257, -4.49733, -4.61099, -4.72353, -4.83495, -4.94523, -5.05436, -5.16234, -5.26914, -5.37477, -5.4792, -5.58244, -5.68446, -5.78525, -5.88481, -5.98312, -6.08018, -6.17597, -6.27048, -6.3637, -6.45562, -6.54622, -6.63551, -6.72346, -6.81006, -6.89531, -6.97919, -7.06169, -7.1428, -7.22252, -7.30082, -7.3777, -7.45315, -7.52715, -7.5997, -7.67078, -7.74039, -7.8085, -7.87512, -7.94023, -8.00382, -8.06587, -8.12639, -8.18534, -8.24274, -8.29856, -8.35279, -8.40542, -8.45644};
        double y2[200]={-1.97635, -1.9516, -1.92818, -1.90604, -1.88514, -1.86544, -1.8469, -1.82947, -1.81311, -1.79777, -1.78342, -1.77, -1.75747, -1.74579, -1.73491, -1.72477, -1.71534, -1.70655, -1.69837, -1.69075, -1.68363, -1.67696, -1.67069, -1.66477, -1.65914, -1.65376, -1.64857, -1.64351, -1.63852, -1.63356, -1.62857, -1.62349, -1.61826, -1.61282, -1.60712, -1.60109, -1.59468, -1.58783, -1.58047, -1.57255, -1.56399, -1.55475, -1.54475, -1.53393, -1.52223, -1.50958, -1.49592, -1.48118, -1.46528, -1.44818, -1.42979, -1.41005, -1.3889, -1.36625, -1.34204, -1.3162, -1.28866, -1.25934, -1.22817, -1.19509, -1.16001, -1.12286, -1.08356, -1.04205, -0.998238, -0.952056, -0.903423, -0.852263, -0.798495, -0.742042, -0.586927, -0.533541, -0.489977, -0.450892, -0.407823, -0.356221, -0.298965, -0.241678, -0.186294, -0.131322, -0.0753164, -0.0195556, 0.0316674, 0.0750014, 0.111281, 0.146538, 0.189475, 0.245515, 0.314501, 0.392105, 0.472901, 0.554077, 0.635266, 0.714868, 0.787144, 0.844439, 0.883377, 0.908523, 0.931811, 0.966549, 1.01851, 1.08177, 1.14195, 1.18506, 1.20405, 1.19864, 1.1773, 1.15158, 1.1194, 1.06567, 0.977524, 0.853718, 0.707453, 0.557468, 0.41328, 0.27297, 0.1306, -0.0169992, -0.168419, -0.321513, -0.481036, -0.659296, -0.862613, -1.08129, -1.29347, -1.47795, -1.62593, -1.7445, -1.85463, -1.98211, -2.14445, -2.34385, -2.56723, -2.79395, -3.00767, -3.19958, -3.36527, -3.50501, -3.62624, -3.74107, -3.85295, -4.00006, -4.14463, -4.28668, -4.42627, -4.5634, -4.69813, -4.83048, -4.96048, -5.08817, -5.21358, -5.33674, -5.45769, -5.57646, -5.69308, -5.80759, -5.92001, -6.03038, -6.13874, -6.24511, -6.34953, -6.45203, -6.55265, -6.65141, -6.74836, -6.84351, -6.93692, -7.0286, -7.11859, -7.20693, -7.29364, -7.37877, -7.46234, -7.54438, -7.62494, -7.70403, -7.7817, -7.85798, -7.9329, -8.00649, -8.07879, -8.14982, -8.21963, -8.28824, -8.35569, -8.42201, -8.48723, -8.55139, -8.61452, -8.67664, -8.73781, -8.79804, -8.85737, -8.91583, -8.97346, -9.03029, -9.08635, -9.14168, -9.1963, -9.25025};
        double y3[200]={-1.9614, -1.93881, -1.91749, -1.89737, -1.8784, -1.86051, -1.84365, -1.82774, -1.81273, -1.79855, -1.78516, -1.77248, -1.76046, -1.74904, -1.73817, -1.72778, -1.71782, -1.70823, -1.69896, -1.68996, -1.68116, -1.67252, -1.66398, -1.65549, -1.64699, -1.63844, -1.62977, -1.62096, -1.61193, -1.60264, -1.59305, -1.5831, -1.57275, -1.56195, -1.55065, -1.5388, -1.52637, -1.5133, -1.49954, -1.48507, -1.46982, -1.45376, -1.43685, -1.41904, -1.40029, -1.38056, -1.35982, -1.33801, -1.3151, -1.29106, -1.26584, -1.2394, -1.21171, -1.18273, -1.15243, -1.12077, -1.08771, -1.05322, -1.01727, -0.979816, -0.940833, -0.900287, -0.858145, -0.814377, -0.76895, -0.721836, -0.673003, -0.622424, -0.570068, -0.515908, -0.410609, -0.3605, -0.312139, -0.261548, -0.206048, -0.146129, -0.0873034, -0.0380798, -0.00183768, 0.0281318, 0.0639872, 0.113774, 0.176783, 0.246061, 0.313921, 0.376129, 0.433078, 0.489828, 0.553163, 0.62565, 0.702464, 0.77477, 0.836869, 0.889943, 0.940108, 0.993329, 1.05132, 1.11079, 1.1661, 1.21358, 1.25279, 1.28408, 1.30636, 1.31761, 1.31693, 1.30449, 1.28272, 1.25631, 1.22693, 1.18914, 1.13258, 1.04825, 0.933866, 0.794995, 0.641187, 0.47915, 0.310736, 0.137416, -0.036899, -0.208372, -0.376418, -0.544228, -0.716114, -0.893101, -1.06856, -1.23125, -1.37786, -1.52019, -1.67703, -1.85822, -2.05602, -2.25193, -2.43153, -2.59272, -2.74784, -2.91619, -3.10456, -3.29696, -3.46685, -3.6005, -3.63684, -3.78351, -3.92733, -4.06835, -4.20663, -4.34223, -4.47521, -4.60562, -4.73353, -4.85899, -4.98205, -5.10278, -5.22124, -5.33748, -5.45156, -5.56354, -5.67348, -5.78143, -5.88745, -5.9916, -6.09394, -6.19452, -6.29341, -6.39066, -6.48633, -6.58048, -6.67316, -6.76444, -6.85437, -6.943, -7.03041, -7.11664, -7.20175, -7.2858, -7.36885, -7.45096, -7.53218, -7.61257, -7.69219, -7.77111, -7.84936, -7.92703, -8.00415, -8.08079, -8.15701, -8.23287, -8.30842, -8.38372, -8.45883, -8.53381, -8.60871, -8.6836, -8.75852, -8.83355, -8.90873, -8.98413, -9.0598, -9.1358, -9.21219, -9.28902};
        
        switch (event_type) {
            case 0:
                for (int i=0; i<200; i++) y[i]=y0[i];
                break;
            case 1:
                for (int i=0; i<200; i++) y[i]=y1[i];
                break;
            case 2:
                for (int i=0; i<200; i++) y[i]=y2[i];
                break;
            case 3:
                for (int i=0; i<200; i++) y[i]=y3[i];
                break;
            default:
                break;
        }
        
        for (int i=0; i<198; i++) {
            if  (m4l_unconstrained>=m[i+0] && m4l_unconstrained<=m[i+1])
                return TMath::Exp( y[i+1]-((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1])))/(m[i]-m[i+1]-(m[i+2]-m[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1]))))*m[i+1] - ((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1])))/(m[i]*m[i]-m[i+1]*m[i+1]-(m[i+2]*m[i+2]-m[i+1]*m[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1]))))*m[i+1]*m[i+1] + ((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1])))/(m[i]-m[i+1]-(m[i+2]-m[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1]))))*m4l_unconstrained  + ((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1])))/(m[i]*m[i]-m[i+1]*m[i+1]-(m[i+2]*m[i+2]-m[i+1]*m[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1]))))*m4l_unconstrained*m4l_unconstrained );
        }
        if  (m4l_unconstrained>=m[198] && m4l_unconstrained<=m[199]) {
            int i = 197;
            return TMath::Exp( y[i+1]-((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1])))/(m[i]-m[i+1]-(m[i+2]-m[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1]))))*m[i+1] - ((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1])))/(m[i]*m[i]-m[i+1]*m[i+1]-(m[i+2]*m[i+2]-m[i+1]*m[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1]))))*m[i+1]*m[i+1] + ((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1])))/(m[i]-m[i+1]-(m[i+2]-m[i+1])*((m[i]*m[i]-m[i+1]*m[i+1])/(m[i+2]*m[i+2]-m[i+1]*m[i+1]))))*m4l_unconstrained  + ((y[i]-y[i+1]-(y[i+2]-y[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1])))/(m[i]*m[i]-m[i+1]*m[i+1]-(m[i+2]*m[i+2]-m[i+1]*m[i+1])*((m[i]-m[i+1])/(m[i+2]-m[i+1]))))*m4l_unconstrained*m4l_unconstrained );}
        
        if  (m4l_unconstrained>m[199]) return TMath::Exp(y[199]);
        else if  (m4l_unconstrained<m[0])  return TMath::Exp(y[0]);
        else return 1;
        
        return -999;
    }
    
    void kd2mela(float KD_discriminant, float m4l_unconstrained, int event_type, float& MELA ) 
    {
        
        MELA = 1/(1 + c_factor(m4l_unconstrained,event_type)*TMath::Exp(-1*KD_discriminant));
        return;
    }
}
